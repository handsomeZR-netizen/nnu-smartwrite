这是一份关于 **NNU-SmartWrite（南师智评）** 项目的开发流程与技术原理的详细介绍。根据你提供的文档和最近的优化记录（如移除 Emoji、升级 AI 模型、增加设置页面等），我为你梳理了整个项目的构建全貌。



### 1. 项目概述



**NNU-SmartWrite** 是一个专为南京师范大学学生设计的 AI 驱动英语写作评价平台。它的核心理念是利用大语言模型（DeepSeek）进行**语义级别**的评估，而非传统的语法规则匹配，从而能够理解语境、接受同义替换，并提供类似真人导师的详细反馈。

------



### 2. 具体开发流程



项目的开发遵循了从基础设施搭建到核心功能实现，再到深度优化和部署的迭代过程：



#### 第一阶段：基础设施与规范确立



1. **项目初始化**：基于 Next.js 14+ (App Router) 搭建项目，配置 TypeScript 和 Tailwind CSS v4。
2. **视觉规范**：定义了南师大品牌色彩系统（深绿 `#1F6A52`、暖珊瑚橙 `#FF7F50` 等）和字体规范，确保视觉上的品牌认同感。
3. **数据模型定义**：使用 TypeScript 接口定义了核心数据结构（如 `EvaluationInput`、`EvaluationResult`），并利用 Zod 库创建验证 Schema，确保数据类型的安全性。



#### 第二阶段：核心功能模块开发



1. **本地存储逻辑**：封装 `localStorage` 操作，实现了无需后端数据库的历史记录功能，支持自动保存、容量限制（10条）和数据读取。
2. **UI 组件库构建**：
   - 基于 shadcn/ui 开发基础组件（Button, Card, Input）。
   - 开发 NNU 特色组件：校徽 (`Logo`)、校训展示 (`Motto`) 和关键的评估结果卡片 (`ResultCard`)。
3. **页面开发**：实现了首页、练习大厅（集成静态题库 JSON）、历史记录页等核心页面。



#### 第三阶段：AI 核心能力集成 (The "Brain")



1. **Prompt 工程**：编写了复杂的系统提示词（System Prompt），设定 AI 为"南师大英语教授"，明确评估标准（信达雅、逻辑性）、评分量表（S/A/B/C）以及强制 JSON 输出格式。
2. **API 路由开发**：创建 `app/api/evaluate/route.ts` 作为后端代理。它负责接收前端请求、拼接 Prompt、调用 DeepSeek API，并将 AI 返回的非结构化文本解析为结构化 JSON 数据。
3. **流式/非流式处理**：虽然设计文档提及流式，但为了保证 JSON 解析的稳定性，目前主要采用等待完整响应后解析的模式，并配合骨架屏优化体验。



#### 第四阶段：深度优化与重构 (你最近的优化)



根据 `AI_UPGRADE_SUMMARY.md` 和 `FRONTEND_UPDATE.md`，项目经历了重大升级：

1. **模型升级**：从基础的 `deepseek-chat` 升级支持 `deepseek-reasoner` (R1)，引入了"AI 推理过程"的可视化展示，让评分更透明。
2. **前端重构**：
   - **去 Emoji 化**：为了提升学术专业度，移除了界面上的 Emoji，替换为 `lucide-react` 线条图标。
   - **交互升级**：添加了"霓虹光效按钮"和文本选择评估功能，支持选中文章中的特定句子进行分析。
   - **布局修复**：解决了导航栏遮挡内容的布局问题。
3. **自定义配置**：新增 `/settings` 页面，允许用户配置自定义的 API Key、Endpoint 和模型，不再局限于系统默认配置。
4. **结构化反馈**：改进了数据结构，将分析结果细分为"优点"、"缺点"、"语境契合度"等独立字段，并支持根据题目类型（翻译 vs 写作）动态展示不同的雷达图维度。



#### 第五阶段：部署与测试



1. **配置 Netlify**：创建 `netlify.toml`，配置 HTTP 安全头（CSP, X-Frame-Options）和构建命令。
2. **修复兼容性**：解决了 Turbopack 警告和 `react-is` 依赖问题，确保构建顺利。
3. **上线**：推送到 GitHub 自动触发 Netlify 部署。

------



### 3. 基本技术原理





#### A. 架构模式：Serverless Frontend



项目采用 **Next.js App Router** 架构。

- **前端 (Client Components)**：负责 UI 渲染、用户交互（表单、图表）、本地状态管理和 LocalStorage 读写。
- **后端 (Server Components / API Routes)**：`app/api/evaluate` 运行在 Netlify Functions (Serverless 环境) 上。它的主要作用是**隐藏 API Key**。客户端不能直接调用 DeepSeek，必须通过这个中间层，确保密钥安全。



#### B. 核心引擎：Prompt Engineering (提示词工程)



这是项目最"智能"的部分。系统不进行传统的自然语言处理（NLP）算法开发，而是通过精心设计的 Prompt "编程" LLM：

1. **角色设定**：你是一个严谨但公平的教授。

2. **规则约束**：必须接受同义词（如 "social obligation" = "social responsibility"）；必须评估语义而非字面匹配。

3. 格式约束：必须输出严格的 JSON 格式，包含 score, analysis, radar_dimensions 等字段。

   这种技术将非结构化的 AI 能力转化为结构化的应用数据。



#### C. 数据流转机制



1. **用户输入**：用户在 `EvaluationForm` 填写题目和答案。
2. **请求封装**：前端将数据发送给 `/api/evaluate`。
3. **AI 处理**：
   - 后端构建完整的 Prompt（包含 System Prompt 和 User Input）。
   - 发送 HTTP 请求给 DeepSeek API (`https://api.deepseek.com/v1/chat/completions`)。
4. **解析与渲染**：
   - AI 返回一段包含 JSON 的文本。
   - 后端通过正则表达式提取并 `JSON.parse` 这段文本，处理潜在的 Markdown 格式问题。
   - 前端接收 JSON 数据，渲染成雷达图和分析卡片。



#### D. 客户端存储 (Persistence)



系统没有使用传统数据库（MySQL/MongoDB）。所有"历史记录"数据都序列化为 JSON 字符串存储在用户的浏览器 `localStorage` 中。

- **优点**：极快、零成本、隐私保护（数据在用户本地）。
- **原理**：通过 `lib/storage.ts` 封装读写逻辑，并在内存中维护一个队列，通过 `unshift` 添加新记录，超过 10 条时 `pop` 掉旧记录。



#### E. 视觉呈现 (Styling)



利用 **Tailwind CSS** 的 Utility-first 特性。

- **响应式**：使用 `md:` `lg:` 前缀适配移动端和桌面端。
- **主题化**：在 `globals.css` 和 `tailwind.config.ts` 中定义 CSS 变量（如 `--nnu-green`），实现全站颜色的一致性更改。
- **动态效果**：使用 CSS 动画实现"霓虹光效"和骨架屏闪烁效果。

总结来说，这是一个典型的 **RAG-lite (Retrieval-Augmented Generation)** 应用雏形（虽然主要是 Generation），利用 Next.js 的全栈能力结合强大的 LLM API，以低成本实现了一个高度定制化的教育评估工具。